---
- name: Download topbeat 1.0.0
  get_url:
    url: "https://download.elastic.co/beats/topbeat/topbeat_1.0.0_amd64.deb"
    dest: "/tmp"

- name: Install topbeat 1.0.0
  apt:
    deb: "/tmp/topbeat_1.0.0_amd64.deb"

- name: Install httplib2
  pip:
    name: httplib2

- name: Enable topbeat at boot
  service:
    name: topbeat
    enabled: yes
  notify:
    - restart topbeat

- name: Ensure {{ topbeat_app_dir }} exists
  file: path={{ topbeat_app_dir }} state=directory owner=root group=root mode=0744

- name: copy config
  template:
    src: topbeat.yml.j2
    dest: "/etc/topbeat/topbeat.yml"
    mode: 0744
  notify: restart topbeat

- name: create symlink to {{ topbeat_app_dir }} for config
  file: src="/etc/topbeat/topbeat.yml" dest="{{ topbeat_app_dir }}/topbeat.yml" state=link
  notify: restart topbeat
